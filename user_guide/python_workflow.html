

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Python workflow tutorial &mdash; KQCircuits 3.4.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/logo.svg"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Macro development" href="macro_workflow.html" />
    <link rel="prev" title="Point-and-click workflow tutorial" href="gui_workflow.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> KQCircuits
          

          
          </a>

          
            
            
              <div class="version">
                3.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gui_features.html">GUI Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_workflow.html">Point-and-click workflow tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python workflow tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-system-hierarchy">File system hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-of-pcell-code">Structure of  PCell code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-of-defining-a-chip-and-an-element">Example of defining a Chip and an Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-of-inserting-an-element">Example of inserting an Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refpoints">Refpoints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="macro_workflow.html">Macro development</a></li>
<li class="toctree-l2"><a class="reference internal" href="export/index.html">Exports</a></li>
<li class="toctree-l2"><a class="reference internal" href="xsection.html">Creating cross section images</a></li>
<li class="toctree-l2"><a class="reference internal" href="terminology.html">Terminology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/kqcircuits.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trademarks.html">Trademarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">KQCircuits</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Python workflow tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user_guide/python_workflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python-workflow-tutorial">
<h1>Python workflow tutorial<a class="headerlink" href="#python-workflow-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This is a collection of tips and tricks about the “Python workflow”.</p>
<p>To unlock the full potential of KQCircuits the user often needs to define new Chips and Elements,
which is done by writing Python code. This can be done in the Macro Editor included in KLayout, or
using any external code editor. To start working with the KQCircuits code base directly, see
<a class="reference internal" href="../developer/setup.html#developer-setup"><span class="std std-ref">Developer Setup</span></a>.</p>
<div class="section" id="file-system-hierarchy">
<h2>File system hierarchy<a class="headerlink" href="#file-system-hierarchy" title="Permalink to this headline">¶</a></h2>
<p>TODO: describe where the different parts of KQCircuits are located in the file system.</p>
</div>
<div class="section" id="structure-of-pcell-code">
<h2>Structure of  PCell code<a class="headerlink" href="#structure-of-pcell-code" title="Permalink to this headline">¶</a></h2>
<p>TODO: describe the general structure of PCell code, Element class, parameters, produce_impl(), etc.</p>
</div>
<div class="section" id="example-of-defining-a-chip-and-an-element">
<h2>Example of defining a Chip and an Element<a class="headerlink" href="#example-of-defining-a-chip-and-an-element" title="Permalink to this headline">¶</a></h2>
<p>TODO: further details about writing Element and Chip code.</p>
</div>
<div class="section" id="example-of-inserting-an-element">
<h2>Example of inserting an Element<a class="headerlink" href="#example-of-inserting-an-element" title="Permalink to this headline">¶</a></h2>
<p>TODO: how to bild new Elements or Chips from existing Elements.</p>
</div>
<div class="section" id="refpoints">
<h2>Refpoints<a class="headerlink" href="#refpoints" title="Permalink to this headline">¶</a></h2>
<p>In an Element definition <code class="docutils literal notranslate"><span class="pre">refpoints</span></code> is just a dictionary of points. You can add to it by
assigning a point to a name, <code class="docutils literal notranslate"><span class="pre">self.refpoints['name']</span> <span class="pre">=</span> <span class="pre">pya.DPoint(...)</span></code>.</p>
<p>There are several ways the refpoints are used:</p>
<ul class="simple">
<li><p>The dictionary of a particular Element instance is returned by <code class="docutils literal notranslate"><span class="pre">self.insert_cell()</span></code>. So you can
insert a cell and then use the refpoints as references where to place other elements in relation
to them.</p></li>
<li><p>If you pass an <code class="docutils literal notranslate"><span class="pre">inst_name</span></code> argument to <code class="docutils literal notranslate"><span class="pre">insert_cell()</span></code> the refpoints are also named uniquely
for the instance as <code class="docutils literal notranslate"><span class="pre">{inst_name}_{refpoint_name}</span></code> and added as text instances to the layout.
This way you can later look up the points by name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">insert_cell</span></code> also has a <code class="docutils literal notranslate"><span class="pre">rec_levels</span></code> argument which determines now many layers down the
hierarchy the refpoints are added.</p></li>
</ul>
<p>How to use the points once they exist? Several styles have evolved:</p>
<ul class="simple">
<li><p>Just use them as a point and perhaps do some geometry calculations to come up with other points
relative to it. This style is mostly useful inside element code, since it is there you really need
to decide on geometry.</p></li>
<li><p>On the Chip or Simulation level you can use <code class="docutils literal notranslate"><span class="pre">align</span></code> and <code class="docutils literal notranslate"><span class="pre">align_to</span></code> arguments of
<code class="docutils literal notranslate"><span class="pre">insert_cell()</span></code>. These can be either a point or a string name referring to a refpoint name, and
will displace (but not not rotate!) the element such that the two points overlap. For example,
<code class="docutils literal notranslate"><span class="pre">insert_cell(SomeElement,</span> <span class="pre">align=&quot;refpoint_of_some_element&quot;,</span>
<span class="pre">align_to=self.refpoints[&quot;existing_ref&quot;])</span></code>.</p></li>
</ul>
<p>There is a convention followed almost everywhere: Places where you normally connect coplanar
waveguides have a refpoint named <code class="docutils literal notranslate"><span class="pre">something_port</span></code> and a second refpoint <code class="docutils literal notranslate"><span class="pre">something_port_corner</span></code>
which is one corner-radius (<code class="docutils literal notranslate"><span class="pre">r</span></code>) away and indicates the direction that the connecting waveguide
should go. You can connect a waveguide correctly by routing it from <code class="docutils literal notranslate"><span class="pre">something_port</span></code> to
<code class="docutils literal notranslate"><span class="pre">something_port_corner</span></code>, and then wherever you want to go (can’t do more than 90 degree turns this
way!). This point is also useful in simulations to pass to <code class="docutils literal notranslate"><span class="pre">produce_waveguide_to_port()</span></code>.</p>
<p>The <a class="reference external" href="../api/kqcircuits.elements.waveguide_composite.html#kqcircuits.elements.waveguide_composite.WaveguideComposite">WaveguideComposite</a>
element has some logic where you can insert arbitrary elements inside waveguides and it uses these
points to align and connect them correctly.</p>
<p>Refpoints are not visible by default in KLayout. Enable the <code class="docutils literal notranslate"><span class="pre">texts/refpoints</span></code> layer to see all
refpoints. If there are many overlapping refpoints the texts can be hard to read. In this case, the
<code class="docutils literal notranslate"><span class="pre">texts/top</span> <span class="pre">refpoints</span></code> layer may be used to see only the top-level refpoints. For this choose a new
top cell by right clicking the chip in the cell view of KLayout and selecting “Show As New Top”.
This can be very useful to see “chip-level” refpoints only.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="macro_workflow.html" class="btn btn-neutral float-right" title="Macro development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="gui_workflow.html" class="btn btn-neutral float-left" title="Point-and-click workflow tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2021, IQM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>